---
title: Atlas架构
description: 
lang: zh
---

Atlas是Mapo Protocol中的`Mapo-Relay-Chain`的名字,是一条EVM(Ethereum Virtual Machine)兼容的区块链，一种开放的加密协议，允许应用程序以安全和去中心化的方式进行交易并运行智能合约。Atlas 区块链代码与以太坊有着共同的祖先，并保持智能合约的完全
EVM 兼容性。然而，它使用拜占庭容错（BFT）共识机制（权益证明）而不是工作量证明，并且具有不同的块格式、交易格式以及天然气支付和定价机制。Atlas主要基于[geth](https://github.com/ethereum/go-ethereum)节点实现。Atlas兼容EVM，支持`web3.js`,`remix`,`hardhat`等应用开发工具。

其主要模块如下：

## Atlas BlockChain

`Atlas`节点的区块链(BlockChain)是atlas区块链的本地数据库，是一个包含区块、交易、账户状态和配置信息的数据库。这个数据库不仅支持数据的持久化存储，还支持高效的数据查询和更新，以确保节点能够与atlas网络保持同步、处理交易和执行智能合约。它是atlas网络的核心数据存储组件,用于存储整个区块链的数据,。

+ `区块链数据库`是 Atlas 节点的核心组件之一，它负责存储整个atlas区块链的数据,且数据库以 `LevelDB` 作为后端存储引擎，用于高效地管理和检索区块链数据。
  
+ `区块`是atlas区块链中的基本数据单元。每个区块包含了一定数量的交易、时间戳、父区块的哈希等信息。这些区块按照时间顺序链接在一起，形成区块链。更多信息请[参考](/docs/base/block/index.md)。

+ `交易`是区块中包含的一系列交易，这些交易包括了atlas网络中的价值转移和智能合约调用。每个交易都有发送者、接收者、数额、智能合约调用数据等信息。更多信息请[参考](/docs/base/transactions/index.md)。

+ `状态存储`是一个关键的数据结构，它跟踪了atlas区块链中每个账户的状态。这包括账户的余额、智能合约代码、存储数据等。状态存储是基于MPT(Merkle Patricia Trie)树的数据结构实现的，用于高效地检索和更新账户状态。

+ `交易池`是 atlas 节点维护的一个缓冲区，用于存储待处理的交易。交易池中的交易等待被打包到新的区块中。
  
+ `账户`：区块链数据库存储了所有atlas账户的信息。这包括外部账户（由私钥控制）和智能合约账户（由智能合约代码控制）。更多信息请[参考](/docs/base/accounts/index.md).

+ `账户状态`是账户的当前状态，包括余额、智能合约代码、存储数据和其他相关信息。账户状态是状态存储的一部分。

+ `区块链索引`：为了提高查询性能，atlas 节点通常会创建各种索引，例如交易索引、日志索引、账户余额索引等。这些索引允许快速检索特定数据而无需扫描整个区块链。


## 共识机制

一组在 Atlas 区块链上运行的智能合约，包含平台功能的大部分逻辑，包括 ERC-20 稳定货币、身份证明、权益证明和治理。这些智能合约是可升级的，
并由去中心化治理流程进行管理。

### Validator

validator 收集从其他节点接收到的交易，并执行任何相关的智能合约以形成新的区块，然后参与拜占庭容错（BFT）共识协议来推进网络的状态。
由于BFT协议只能扩展到几百个参与者，并且最多只能容忍三分之一的参与者恶意行为，权益证明机制只允许有限的一组节点担任此角色。

## 网络层

Geth 的网络层负责与以太坊网络中的其他节点通信。它使用 Ethereum Wire Protocol 来传输数据和消息。网络层允许节点之间进行握手、交换区块、交易和状态信息，以保持整个网络的同步。

Geth 实现了以太坊的 P2P 协议，允许节点在网络中广播、接收和处理消息。这些消息包括区块、交易、状态信息等。